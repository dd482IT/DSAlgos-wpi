package ds;

@org.checkerframework.framework.qual.AnnotatedFor("org.checkerframework.checker.nullness.NullnessChecker")
public class ShellSortByThree extends AbstractSort {

    private static final  @org.checkerframework.checker.initialization.qual.Initialized @org.checkerframework.checker.nullness.qual.NonNull int THREE = 3;

    protected  @org.checkerframework.checker.initialization.qual.Initialized @org.checkerframework.checker.nullness.qual.NonNull int gapCount;

    @org.checkerframework.dataflow.qual.Pure
    public  @org.checkerframework.checker.initialization.qual.Initialized @org.checkerframework.checker.nullness.qual.NonNull int getTimeComplexity(@org.checkerframework.checker.initialization.qual.Initialized @org.checkerframework.checker.nullness.qual.NonNull ShellSortByThree this) {
        return innerLoopCount > 0 ? innerLoopCount : outerLoopCount > 0 ? outerLoopCount : gapCount;
    }

    protected void reset(@org.checkerframework.checker.initialization.qual.Initialized @org.checkerframework.checker.nullness.qual.NonNull ShellSortByThree this) {
        super.reset();
        gapCount = 0;
    }

    protected void sort(@org.checkerframework.checker.initialization.qual.Initialized @org.checkerframework.checker.nullness.qual.NonNull ShellSortByThree this,  @org.checkerframework.checker.initialization.qual.Initialized @org.checkerframework.checker.nullness.qual.NonNull long @org.checkerframework.checker.initialization.qual.Initialized @org.checkerframework.checker.nullness.qual.NonNull [] a,  @org.checkerframework.checker.initialization.qual.Initialized @org.checkerframework.checker.nullness.qual.NonNull int length) {
        reset();
        if (length <= 1)
            return;
        int n = length;
        int h = 1;
        while (h <= n / THREE) h = h * THREE + 1;
        // decreasing h, until h=1
        while (h > 0) {
            ++gapCount;
            for (int outer = h; outer < n; outer++) {
                long temp = a[outer];
                ++outerLoopCount;
                int inner = outer;
                while (inner > h - 1 && a[inner - h] >= temp) {
                    ++innerLoopCount;
                    ++comparisonCount;
                    ++copyCount;
                    System.arraycopy(a, inner - h, a, inner, 1);
                    inner -= h;
                }
                if (inner > h - 1)
                    ++comparisonCount;
                a[inner] = temp;
            }
            h = (h - 1) / THREE;
        }
    }
}
